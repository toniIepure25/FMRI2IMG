schema: '2.0'
stages:
  prepare_data:
    cmd: python -m fmri2image.data.download_nsd --raw_root data/raw
    deps:
    - path: configs/paths/paths.yaml
      hash: md5
      md5: 8f28bb84db3bdc7a4e9ff462057c7078
      size: 149
    - path: src/fmri2image/data/download_nsd.py
      hash: md5
      md5: abd4099492831141fa689f051c584af9
      size: 920
    outs:
    - path: data/raw/nsd
      hash: md5
      md5: 79a62e2ffa10ebce2562583f42158d68.dir
      size: 219
      nfiles: 2
  baseline_train:
    cmd: python -m fmri2image.cli ++run.name=baseline_train train=baseline
    deps:
    - path: configs/config.yaml
      hash: md5
      md5: c341062c96b325785ce81f82fb812de0
      size: 211
    - path: configs/train/baseline.yaml
      hash: md5
      md5: 4424135d9170c50e26a916499bf1ba40
      size: 931
    - path: data/processed/nsd/clip_text.npy
      hash: md5
      md5: 2577ce444d57eb6c9b162b4a4c8b09f4
      size: 6272
    - path: data/processed/nsd/roi/subj01_roi.npy
      hash: md5
      md5: 47c9fb596d852b19d0a97abc4504a6ae
      size: 983168
    - path: src/fmri2image/data/nsd_reader.py
      hash: md5
      md5: 36d85d4ecab163fa022f4e5388d56dda
      size: 1110
    - path: src/fmri2image/models/encoders/mlp_encoder.py
      hash: md5
      md5: 66e2f739ca3c679e83a79332265da2fa
      size: 448
    - path: src/fmri2image/pipelines/baseline_train.py
      hash: md5
      md5: 4235ee8e77b289eed2ec57285a46fbab
      size: 9838
    outs:
    - path: outputs
      hash: md5
      md5: 69759c9ee2ed9b9fb9ba32a4d660985b.dir
      size: 6730
      nfiles: 4
  roi_extract:
    cmd: "python -m fmri2image.data.extract_roi --fmriprep_dir data/processed/nsd/fmriprep
      --out_dir data/processed/nsd/roi --mode atlas --atlas glasser --vector_dim 2048
      --subject subj01\n"
    deps:
    - path: configs/data/nsd.yaml
      hash: md5
      md5: aa0676ebabf3bfd4721381d7f051c949
      size: 589
    - path: src/fmri2image/data/extract_roi.py
      hash: md5
      md5: 972f9e67547e89b6abb352e69d6ff970
      size: 1133
    outs:
    - path: data/processed/nsd/roi
      hash: md5
      md5: b114b4dbddd4b453946cb1a555809659.dir
      size: 983168
      nfiles: 1
  clip_text:
    cmd: "python -m fmri2image.text.clip_text --captions data/raw/nsd/captions.csv
      --out data/processed/nsd/clip_text.npy\n"
    deps:
    - path: data/raw/nsd/captions.csv
      hash: md5
      md5: 2cfdc695fc4d02a0aef4e9c1185bf1ae
      size: 65
    - path: src/fmri2image/text/clip_text.py
      hash: md5
      md5: 6a157c4ab11fcd3922ff2414e344cc67
      size: 1277
    outs:
    - path: data/processed/nsd/clip_text.npy
      hash: md5
      md5: 2577ce444d57eb6c9b162b4a4c8b09f4
      size: 6272
  pretrain_encoder:
    cmd: "python -m fmri2image.selfsupervised.pretrain_fmri --images_root data/raw/nsd/images
      --fmri_root data/raw/nsd/fmri --captions data/raw/nsd/captions.csv --roi_dir
      data/processed/nsd/roi --subject subj01 --dim 2048 --mask_ratio 0.5 --lr 1e-3
      --epochs 2 --batch_size 16 --num_workers 4 --out_ckpt data/artifacts/encoder_pretrained.ckpt\n"
    deps:
    - path: data/processed/nsd/roi/subj01_roi.npy
      hash: md5
      md5: 47c9fb596d852b19d0a97abc4504a6ae
      size: 983168
    - path: src/fmri2image/data/nsd_reader.py
      hash: md5
      md5: 36d85d4ecab163fa022f4e5388d56dda
      size: 1110
    - path: src/fmri2image/selfsupervised/pretrain_fmri.py
      hash: md5
      md5: 4f5b993d4bad0747b4dedd699e4ee9a5
      size: 3960
    outs:
    - path: data/artifacts/encoder_pretrained.ckpt
      hash: md5
      md5: 04a629f13e039b482e0b6686f20ab5a3
      size: 25180747
